\documentclass[border=1cm]{standalone}

\usepackage{tikz}
\usetikzlibrary{shapes.geometric, shapes.misc}
\usetikzlibrary{cd, fit, calc}
\usetikzlibrary{positioning}
\usetikzlibrary{decorations.markings}
\usepackage{medl_colors}
\usepackage{fontspec}

\usepackage{arrayjob}
\def\words{{
{"We","Enjoyed","Writing", "This", "Book", "<start>", "nous","avons","aimé", "écrire", "ce", "livre"},
{"", "", "", "", "", "nous","avons","aimé", "écrire", "ce", "livre", "<end>"}
}}

\begin{document}
\begin{tikzpicture}

\pgfdeclarelayer{layer1}
\pgfdeclarelayer{layer2}
\pgfsetlayers{layer2,layer1}

\begin{pgfonlayer}{layer1}
\foreach \i in {1,...,12}
{
    \pgfmathparse{int(\i-1)}\edef\j{\pgfmathresult};
    \pgfmathparse{\words[1][\j]} \edef\topword{\pgfmathresult};
    \pgfmathparse{\words[0][\j]} \edef\bottomword{\pgfmathresult};
    \node[draw, rounded corners, minimum width=1cm, minimum height=1cm, fill=fblue] (unit\i) at (\j*2, 0) { unit };
    \ifnum\i>1
        \draw[-Triangle] (unit\j) -- (unit\i);
    \fi
    \node[above of=unit\i, node distance= 2cm] (top\i) { \texttt{ \topword }};
    \node[below of=unit\i, node distance= 2cm] (bottom\i) {\texttt{ \bottomword} };

}

\foreach \i in {6,...,12}
{
    \ifnum\i<12
        \pgfmathparse{\i+1}\edef\ni{\pgfmathresult};
        \draw[-Triangle,thick, bend right, looseness=1] (top\i) to[out=90, in=-90] ([xshift=-1.2cm]bottom\ni);
    \fi
    \draw[-Triangle] (unit\i) -- (top\i);
}

\foreach \i in {1,...,6}
{
    \draw[-Triangle] (bottom\i) -- (unit\i);
}
\end{pgfonlayer}

\begin{pgfonlayer}{layer2}
\node [rounded corners, draw, fill=fgreen, minimum width=9.5cm, minimum height=2.5cm, below of=unit3, node distance=0cm] (rect1)  {};

\node [rounded corners, draw, fill=redlight, minimum width=13.5cm, minimum height=2.5cm, below of=unit9, node distance=0cm] (rect2)  {};

\node [rounded corners, black!50, minimum width=9.5cm, minimum height=7cm, below of=unit3, node distance=.5cm] (rect3)  {};
\node [rounded corners, black!50, minimum width=13.5cm, minimum height=8cm, below of=unit9, node distance=0cm] (rect4)  {};

\node [above of=rect3, node distance=3cm] { Encoder };
\node [below of=rect4, node distance=3.5cm] { Decoder };

\node [below of=rect1, node distance=2.8cm] { Input: Source Sentence} ;
\node [above of=rect2, node distance=3cm] { Output: Source Sentence};

\draw ([xshift=2mm, yshift=2.2cm]rect2.west) -- ([xshift=2mm, yshift=2.5cm]rect2.west) -- ([xshift=-2mm, yshift=2.5cm]rect2.east) -- ([xshift=-2mm, yshift=2.2cm]rect2.east) ;

\draw ([xshift=2mm, yshift=-2cm]rect1.west) -- ([xshift=2mm, yshift=-2.3cm]rect1.west) -- ([xshift=-2mm, yshift=-2.3cm]rect1.east) -- ([xshift=-2mm, yshift=-2cm]rect1.east) ;

\end{pgfonlayer}

\end{tikzpicture}
\end{document}
