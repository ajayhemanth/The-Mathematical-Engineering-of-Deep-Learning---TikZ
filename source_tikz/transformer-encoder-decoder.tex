\documentclass[border=1cm]{standalone}

\usepackage{tikz}
\usetikzlibrary{shapes.geometric, shapes.misc}
\usetikzlibrary{cd, fit, calc}
\usetikzlibrary{positioning}
\usetikzlibrary{decorations.markings}
\usepackage{medl_colors}

\begin{document}
\begin{tikzpicture}

\node[draw, dashed, ultra thick, draw=fblue, rounded corners, minimum width=3cm, minimum height=1cm] (unit11) {\parindent=1cm $a_{out}^{\langle 1\rangle }$  \indent $a_{out}^{\langle T\rangle }$};
\node[draw, dashed, ultra thick, draw=fblue, rounded corners, minimum width=3cm, minimum height=1cm, node distance=5cm, right of = unit11] (unit21) {\parindent=1cm $\hat y_{out}^{\langle 1\rangle }$  \indent $\hat y_{out}^{\langle T\rangle }$};

\node[draw, rounded corners, minimum width=3cm, minimum height=1cm, below of = unit11, node distance = 2cm, align=center] (unit12) {Transformer\\Block};
\node[draw, rounded corners, minimum width=3cm, minimum height=1cm, below of = unit21, node distance = 2cm, align=center] (unit22) {Transformer\\Decoder Block};

\node[minimum width=3cm, minimum height=1cm, below of = unit12, node distance = 2cm, align=center] (unit13) { .\\.\\.};
\node[minimum width=3cm, minimum height=1cm, below of = unit22, node distance = 2cm, align=center] (unit23) { .\\.\\.};

\node[draw, rounded corners, minimum width=3cm, minimum height=1cm, below of = unit13, node distance = 2cm, align=center] (unit14) {Transformer\\Block};
\node[draw, rounded corners, minimum width=3cm, minimum height=1cm, below of = unit23, node distance = 2cm, align=center] (unit24) {Transformer\\Decoder Block};

\node[draw, rounded corners, minimum width=3cm, minimum height=1cm, below of = unit14, node distance = 2cm, align=center] (unit15) {Transformer\\Block};
\node[draw, rounded corners, minimum width=3cm, minimum height=1cm, below of = unit24, node distance = 2cm, align=center] (unit25) {Transformer\\Decoder Block};

\node[draw, dashed, ultra thick, draw=fblue, rounded corners, minimum width=3cm, minimum height=1cm, node distance=2cm, below of = unit15 ] (unit16) {\parindent=1cm $\tilde x_{out}^{\langle 1\rangle }$  \indent $\tilde x_{out}^{\langle T\rangle }$};
\node[draw, dashed, ultra thick, draw=fblue, rounded corners, minimum width=3cm, minimum height=1cm, node distance=2cm, below of = unit25] (unit26) {\parindent=1cm $\tilde y_{out}^{\langle 1\rangle }$  \indent $\tilde y_{out}^{\langle T\rangle }$};

\node[draw, dashed, ultra thick, draw=fblue, rounded corners, minimum width=3cm, minimum height=1cm, node distance=2cm, below of = unit16 ] (unit17) {\parindent=1cm $x_{out}^{\langle 1\rangle }$  \indent $x_{out}^{\langle T\rangle }$};
\node[draw, dashed, ultra thick, draw=fblue, rounded corners, minimum width=3cm, minimum height=1cm, node distance=2cm, below of = unit26] (unit27) {\parindent=1cm $y_{out}^{\langle 1\rangle }$  \indent $y_{out}^{\langle T\rangle }$};

\foreach \i in {2,...,7}
{
    \pgfmathparse{int(\i-1)}\edef\j{\pgfmathresult};
    \draw[-Triangle, draw=black!50, thick] (unit1\i) -- (unit1\j);
    \draw[-Triangle, draw=black!50, thick] (unit2\i) -- (unit2\j);
}

\node[ above right = .25cm and -1.5cm of unit17, align=center] {\tiny positional embedding};
\node[ above right = .25cm and -1.5cm of unit27, align=center] {\tiny positional embedding};
\node[below of = unit17, node distance=1cm] {Encoder};
\node[below of = unit27, node distance=1cm] {Decoder};

\node[ above right = .25cm and -1.5cm of unit12, align=center] (mark1) {\tiny {\Large $z^*$}};

\draw[Triangle-, draw=black!50, thick] (unit27.east) -| ++(2cm, 0) |- (unit21.east);
\draw[-Triangle, draw=black!50, thick] (mark1) -| ++(2cm, 0) |- (unit22.west);
\draw[-Triangle, draw=black!50, thick] (mark1) -| ++(2cm, 0) |- (unit24.west);
\draw[-Triangle, draw=black!50, thick] (mark1) -| ++(2cm, 0) |- (unit25.west);



\end{tikzpicture}
\end{document}
